!function(l,u,p,t){"use strict";var c=l(u),d=l(p),h="paver",g={failureMessage:"Scroll left/right to pan through panorama.",failureMessageInsert:"after",gracefulFailure:!0,meta:!1,responsive:!0,startPosition:.5,minimumOverflow:200,grain:3,cursorThrottle:1e3/60,gyroscopeThrottle:1e3/60,resizeThrottle:500,mouseSmoothingFunction:"linear",tilt:!0,tiltSensitivity:.1,tiltScrollerPersistence:500,tiltSmoothingFunction:"gaussian",tiltThresholdPortrait:12,tiltThresholdLandscape:24},v={};void 0===console&&(console={},void 0===console.info&&(console.info=function(){}),void 0===console.warn&&(console.warn=function(){}));var f=function(t,e){if(this.element=t,this.settings=l.extend({},g,e,l(this.element).data()),parseInt(this.settings.grain<=0)&&(this.settings.grain=1),this.settings.startPosition=Math.max(Math.min(this.settings.startPosition,1),0),this.settings.tiltThresholdPortrait=Math.max(Math.min(this.settings.tiltThresholdPortrait,180),0),this.settings.tiltThresholdLandscape=Math.max(Math.min(this.settings.tiltThresholdLandscape,180),0),this._name=h,this.mousemove={},v.features.hasGyroscope)this.init();else{if(v.features.isTouch)return void this.fallback();this.init()}};l.extend(f.prototype,{init:function(){d.trigger("enabled.paver"),m.defineElements(this);var a=this;if(!a.instanceData||!a.instanceData.initialized){a.instanceData={},a.instanceData.initialized=!0,a.instanceData.originalNode=a.$t.html(),m.domReplacement(this),m.getContainerDimensions(this),m.getCenter(this);var t=new Image,e=function(){if(a.$t.trigger("imageLoadDone.paver"),a.instanceData.naturalWidth=a.$p[0].naturalWidth,a.instanceData.naturalHeight=a.$p[0].naturalHeight,a.instanceData.panoAspectRatio=a.instanceData.naturalWidth/a.instanceData.naturalHeight,a.instanceData.containerAspectRatio=a.instanceData.outerWidth/a.instanceData.outerHeight,m.checkURL(a.$p.attr("src")))return!1;m.replacePanorama(a),m.compute(a),m.checkOverflow(a)?(a.instanceData.panCounter=0,a.pan({xPos:a.settings.startPosition,yPos:a.settings.startPosition}),m.paverOn(a)):m.paverOff(a),c.on("resize",l.throttle(a.settings.resizeThrottle,function(){a.recompute()})),a.$t.on("recompute.paver",function(){a.recompute()}),a.$t.on("destroy.paver",function(){a.destroy()}),a.$t.on("pan.paver",function(t,e){a.pan(e)})},n=!1,i=setInterval(function(){t.naturalWidth&&t.naturalHeight&&(e(),n=!0,u.clearInterval(i))},100);t.onload=function(){n||e(),u.clearInterval(i)},t.src=a.$p.attr("src")}},fallback:function(){if(d.trigger("disabled.paver"),this.settings.gracefulFailure){var t=l(this.element),e=l("<div />",{class:"paver__fallbackMessage"});switch(t.addClass("paver--fallback"),this.settings.failureMessageInsert.toLowerCase()){case"after":t.after(e.html(this.settings.failureMessage));break;case"before":t.before(e.html(this.settings.failureMessage));break;case"prepend":t.prepend(e.html(this.settings.failureMessage));break;case"append":t.append(e.html(this.settings.failureMessage));break;default:t.after(e.html(this.settings.failureMessage))}t.trigger("fallbackend.paver")}},unbindEvents:function(){l(this.element).off("mousemove.paver devicetilt.paver").removeClass("paver--on").addClass("paver--off")},destroy:function(){var t=l(this.element).data("plugin_paver");t&&(this.unbindEvents(),l(this.element).trigger("destroyed.paver").removeClass("paver--initialized paver--ready").empty().html(t.instanceData.originalNode),l(this.element).data("plugin_paver",null))},recompute:function(){var t=l(this.element),e=t.data("plugin_paver");t.off("mousemove.paver devicetilt.paver"),m.getContainerDimensions(this),e.instanceData.containerAspectRatio=e.instanceData.outerWidth/e.instanceData.outerHeight,t.trigger("recomputeStart.paver"),m.compute(this),m.checkOverflow(this)?(e.pan({xPos:Math.min(e.instanceData.lastPanX,1),yPos:Math.min(e.instanceData.lastPanY,1)}),m.paverOn(this)):m.paverOff(this)},pan:function(t){var e=l(this.element),a=e.find("div.paver__scroller"),n=a.find("span"),i=parseInt(this.settings.grain),s=e.data("plugin_paver");t?(void 0===t.xPos&&(t.xPos=s.settings.startPosition),void 0===t.yPos&&(t.yPos=s.settings.startPosition)):t={xPos:s.settings.startPosition,yPos:s.settings.startPosition},1<t.xPos?t.xPos=1:t.xPos<0&&(t.xPos=0),1<t.yPos?t.yPos=1:t.yPos<0&&(t.yPos=0);var r=t.xPos.toFixed(i),o=t.yPos.toFixed(i);s.instanceData.panCounter&&0!==s.instanceData.panCounter?e.trigger("panStart.paver"):e.trigger("initialPanStart.paver"),e.find("div.paver__pano").css("transform","translate("+-r*(s.instanceData.computedWidth-s.instanceData.outerWidth)+"px, "+-o*(s.instanceData.computedHeight-s.instanceData.outerHeight)+"px)").end().find("div.paver__scroller span").css("transform","translateX("+r*(a.width()-n.width())+"px)").end(),c.one(m.whichTransitionEnd(),function(){s.instanceData.panCounter&&0!==s.instanceData.panCounter?e.trigger("panEnd.paver"):e.trigger("initialPanEnd.paver")}),s.instanceData.panCounter+=1,s.instanceData.lastPanX=r,s.instanceData.lastPanY=o}});var m={whichTransitionEnd:function(){var t,e=p.createElement("div"),a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(t in a)if(void 0!==e.style[t])return a[t]},normalcdf:function(t,e,a){var n=(a-t)/Math.sqrt(2*e*e),i=1/(1+.3275911*Math.abs(n)),s=1;return n<0&&(s=-1),.5*(1+s*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-n*n)))},smoothingFunction:{linear:function(t,e){return e<=t?1:t<=-e?0:.5*(t/e+1)},tangent:function(t,e){return e<=t?1:t<=-e?0:.5*(.5*Math.tan(t/e*(.351*Math.PI))+1)},cosine:function(t,e){return e<=t?1:t<=-e?0:.5*(Math.sin(t/e*(Math.PI/2))+1)},gaussian:function(t,e){return e<=t?1:t<=-e?0:m.normalcdf(0,.375,t/e)}},defineElements:function(t){t.t=t.element,t.$t=l(t.element),t.$p=t.$t.find("img").first(),t.instanceData=t.$t.data("instance-data")},domReplacement:function(t){t.$t.addClass("paver--initialized").append(l("<div />",{class:"paver__meta"})),!t.settings.meta||void 0===t.$p.attr("title")&&void 0===t.$p.attr("alt")||!t.$p.attr("title").length&&!t.$p.attr("alt").length||t.$t.addClass("paver--metaActive").find(".paver__meta").html('<span class="paver__title">'+t.$p.attr("title")+'</span><span class="paver__desc">'+t.$p.attr("alt")+"</span>"),t.$t.trigger("init.paver")},getContainerDimensions:function(t){t.instanceData.outerWidth=t.$t.width(),t.instanceData.outerHeight=t.$t.height(),t.instanceData.offsetX=t.$t.offset().left,t.instanceData.offsetY=t.$t.offset().top},getCenter:function(t){t.instanceData.centerX=.5*t.instanceData.outerWidth,t.instanceData.centerY=.5*t.instanceData.outerHeight},replacePanorama:function(t){var e=l("<div />",{class:"paver__pano"}).css("background-image","url("+m.formatURL(t.$p.attr("src"))+")"),a=l("<div />",{class:"paver__scroller"}).append(l("<span />"));t.$t.addClass("paver--ready").append(e).append(a),t.$p.remove(),t.$t.trigger("ready.paver"),t.instanceData.ready=!0},checkOverflow:function(t){return t.instanceData.containerAspectRatio<=t.instanceData.panoAspectRatio&&t.instanceData.outerWidth<=t.instanceData.computedWidth-t.settings.minimumOverflow},paverOn:function(t){t.$t.removeClass("paver--off").addClass("paver--on").find("div.paver__pano").css("left",0),m.bindEvents(t)},paverOff:function(t){t.unbindEvents(t),t.settings.responsive&&(t.instanceData.naturalWidth<=t.instanceData.outerWidth||t.$t.css("min-height",t.instanceData.outerWidth/t.instanceData.panoAspectRatio).find("div.paver__pano").css({width:t.instanceData.outerWidth,height:"100%",left:"50%",transform:"translateX(-50%)"}))},compute:function(t){t.instanceData.computedWidth=t.instanceData.outerHeight*t.instanceData.panoAspectRatio,t.instanceData.computedHeight=t.instanceData.computedWidth/t.instanceData.panoAspectRatio,m.getCenter(t),t.$t.find("div.paver__pano").css({width:t.instanceData.computedWidth,height:t.instanceData.outerHeight}),t.$t.trigger("computeEnd.paver")},bindEvents:function(t){v.features.isTouch?v.features.hasGyroscope&&t.settings.tilt&&m.bindOrientationEvents(t):m.bindMouseEvents(t),t.$t.trigger("eventsBound.paver")},bindMouseEvents:function(a){a.$t.on("mousemove.paver",l.throttle(a.settings.cursorThrottle,function(t){if(a.mousemove.dX=t.pageX-a.instanceData.offsetX-a.instanceData.centerX,a.mousemove.dY=t.pageY-a.instanceData.offsetY-a.instanceData.centerY,"string"==typeof a.settings.mouseSmoothingFunction)m.defaultSmooth(a,a.settings.mouseSmoothingFunction,a.mousemove.dX,a.instanceData.centerX,a.mousemove.dY,a.instanceData.centerY);else if("function"==typeof a.settings.mouseSmoothingFunction){var e=a.settings.mouseSmoothingFunction.call(a,a.mousemove.dX,a.instanceData.centerX,a.mousemove.dY,a.instanceData.centerY);if(void 0===e)return void m.defaultSmooth(a,g.settings.mouseSmoothingFunction,a.mousemove.dX,a.instanceData.centerX,a.mousemove.dY,a.instanceData.centerY);a.pan({xPos:e.x,yPos:e.y})}}))},bindOrientationEvents:function(s){s.instanceData.prevTilt={};var r=null;s.$t.on("devicetilt.paver",l.throttle(s.settings.gyroscopeThrottle,function(t,e){if(0===s.settings.tiltScrollerPersistence)s.$t.addClass("paver--tilting");else if(!l.isEmptyObject(s.instanceData.prevTilt)&&(Math.abs(s.instanceData.prevTilt.b-e.b)>s.settings.tiltSensitivity||Math.abs(s.instanceData.prevTilt.g-e.g)>s.settings.tiltSensitivity)||l.isEmptyObject(s.instanceData.prevTilt)){s.$t.addClass("paver--tilting"),null!==r&&clearTimeout(r),r=u.setTimeout(function(){s.$t.removeClass("paver--tilting")},s.settings.tiltScrollerPersistence);var a,n={};switch(v.screenOrientationAngle){case 0:n={beta:e.b,gamma:e.g},a=s.settings.tiltThresholdPortrait;break;case 180:case-180:n={beta:-e.b,gamma:-e.g},a=s.settings.tiltThresholdPortrait;break;case 90:case-270:n={beta:-e.g,gamma:e.b},a=s.settings.tiltThresholdLandscape;break;case 270:case-90:n={beta:e.g,gamma:-e.b},a=s.settings.tiltThresholdLandscape;break;default:n={beta:e.b,gamma:e.g},a=s.settings.tiltThresholdPortrait}if("string"==typeof s.settings.tiltSmoothingFunction)m.defaultSmooth(s,s.settings.tiltSmoothingFunction,n.gamma,a,n.beta,a);else if("function"==typeof s.settings.tiltSmoothingFunction){var i=s.settings.mouseSmoothingFunction.call(s,n.gamma,a,n.beta,a);if(void 0===i)return void m.defaultSmooth(s,s.settings.tiltSmoothingFunction,n.gamma,a,n.beta,a);s.pan({xPos:i.x,yPos:i.y})}s.instanceData.prevTilt={a:e.a,b:e.b,g:e.g}}}))},defaultSmooth:function(t,e,a,n,i,s){var r=m.smoothingFunction[e];t.pan({xPos:r(a,n),yPos:r(i,s)})},checkURL:function(t){var e=0;return/[\s+]/g.test(t)?(console.warn("Paver: Paver has detected characters in your URL string ("+t+") that need to be properly encoded/escaped. Whitespace(s) have to be escaped manually. See RFC3986 documentation."),e=1):/[\"\'\(\)]/g.test(t)&&(console.warn("Paver: Plugin will proceed, but it has detected characters in your URL string ("+t+") that need to be properly encoded/escaped. These will be escaped for you. See RFC3986 documentation."),e=0),e},formatURL:function(t){return t.replace(/"/g,"%22").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}};l.fn.paver=function(n){var e=this,i=arguments;v={features:{isTouch:!1,hasGyroscope:!1,hasScreenOrientationAPI:!(!u.screen||!u.screen.orientation||void 0===u.screen.orientation.angle||null===u.screen.orientation.angle)},screenOrientationAngle:null,startTilt:{}};var t=function(){var e=new l.Deferred,a=function(t){return null!==t.alpha&&null!==t.beta&&null!==t.gamma?e.resolve({orientation:{alpha:t.alpha,beta:t.beta,gamma:t.gamma},status:{deviceOrientationEventSupport:!0,deviceOrientationData:!0}}):e.reject({status:{deviceOrientationEventSupport:!0,deviceOrientationData:!1}}),u.removeEventListener("deviceorientation",a,!1),!0,e.promise()};return u.DeviceOrientationEvent?(u.addEventListener("deviceorientation",a,!1),u.setTimeout(function(){return console.info("DeviceOrientationEvent support is detected, but browser is not feeding any gyroscopic data. Will not check for further gyroscopic data."),e.reject({status:{deviceOrientationEventSupport:!0,deviceOrientationData:!1}}),e.promise()},250)):e.reject({status:{deviceOrientationEventSupport:!1,deviceOrientationData:!1}}),e.promise()},a=function(){v.screenOrientationAngle=v.features.hasScreenOrientationAPI?u.screen.orientation.angle:u.orientation||0};(function(){try{p.createEvent("TouchEvent"),v.features.isTouch=!0}catch(t){v.features.isTouch=!1}})(),a(),u.addEventListener("orientationchange",function(){a(),t()},!1);var s=function(){var e,a=l(this);return v.features.hasGyroscope&&u.addEventListener("deviceorientation",function(t){var e={a:t.alpha-v.startTilt.alpha,b:t.beta-v.startTilt.beta,g:t.gamma-v.startTilt.gamma};a.trigger("devicetilt.paver",[e])},!1),void 0===n||"object"==typeof n?a.each(function(){l.data(this,"plugin_"+h)||l.data(this,"plugin_"+h,new f(this,n))}):"string"==typeof n&&"_"!==n[0]&&"init"!==n?(a.each(function(){var t=l.data(this,"plugin_"+h);t instanceof f&&"function"==typeof t[n]&&(e=t[n].apply(t,Array.prototype.slice.call(i,1)))}),void 0!==e?e:a):void 0},r=function(t){v.features.hasGyroscope=!0,v.startTilt.alpha=t.orientation.alpha,v.startTilt.beta=t.orientation.beta,v.startTilt.gamma=t.orientation.gamma,d.trigger("hasGyroscopeData.paver",[t]),s.call(e)},o=function(){console.info("Gyroscopic data unavailable. Falling back to cursor-based panning.");v.features.hasGyroscope=!1;d.trigger("hasNoGyroscopeData.paver",[{status:{deviceOrientationEventSupport:!1,deviceOrientationData:!1}}]),s.call(e)},c=l.extend({},g,n,l(this.element).data());return l.when(t()).then(function(t){void 0===t||!0!==c.tilt?o():r(t)},function(){o()}),e}}(jQuery,window,document);